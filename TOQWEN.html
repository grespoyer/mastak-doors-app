<!DOCTYPE html>
<html>
<head>
    <title>File Content Copier</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        #fileList div { margin: 5px 0; }
        button { margin-top: 15px; padding: 8px 16px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        .file-info { color: #666; font-size: 0.9em; margin-left: 20px; }
        .note { color: #4361ee; font-size: 0.9em; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Выберите файлы для экспорта</h2>
        <input type="file" id="fileInput" webkitdirectory multiple>
        <div class="note">ℹ️ Для сохранения структуры папок выберите <strong>папку</strong> (не отдельные файлы)</div>
        <div id="fileList"></div>
        <button id="generateBtn">Сгенерировать файл</button>
    </div>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            Array.from(e.target.files).forEach((file, index) => {
                // Используем относительный путь из файловой системы
                const filePath = file.webkitRelativePath || file.name;
                
                const fileDiv = document.createElement('div');
                fileDiv.innerHTML = `
                    <label>
                        <input type="checkbox" data-index="${index}" checked>
                        ${filePath}
                    </label>
                    <div class="file-info">(${formatFileSize(file.size)}, ${file.type || 'неизвестный тип'})</div>
                `;
                fileList.appendChild(fileDiv);
            });
        });

        document.getElementById('generateBtn').addEventListener('click', async function() {
            const checkboxes = document.querySelectorAll('#fileList input[type="checkbox"]:checked');
            const files = Array.from(document.getElementById('fileInput').files);
            const selectedFiles = Array.from(checkboxes).map(cb => 
                files[parseInt(cb.dataset.index)]
            );

            if (selectedFiles.length === 0) {
                alert('Выберите хотя бы один файл!');
                return;
            }

            let outputContent = '';
            for (const file of selectedFiles) {
                try {
                    const content = await readFileContent(file);
                    // Используем реальный относительный путь
                    const filePath = file.webkitRelativePath || file.name;
                    outputContent += `${filePath}:\n${content}\n\n`;
                } catch (error) {
                    console.error(`Ошибка чтения файла ${file.name}:`, error);
                    outputContent += `${file.webkitRelativePath || file.name}:\n[Ошибка чтения файла]\n\n`;
                }
            }

            downloadFile(outputContent, 'exported_files.txt');
        });

        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsText(file, 'UTF-8');
            });
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>